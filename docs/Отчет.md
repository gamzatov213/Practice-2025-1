# Технический отчет по проекту  
**«PsychologistAITelegramBot»**

## Исследование предметной области и последовательность действий

В рамках проекта мы изучили существующие Telegram-боты психологической тематики: такие боты облегчают доступ к самопомощи и поддержке, но не заменяют профессионального психолога. Например, бесплатные боты часто представляют собой упорядоченную информацию и инструкции по управлению стрессом и эмоциями. 

На основе этого анализа мы определили основные этапы работы над ботом:

- **Анализ требований и сбор информации.**  

Изучены популярные психологические боты (DBT-skills, ЭмоТрек и др.), выявлены их функции (практики самопомощи, трекинг состояний, мультиязычная поддержка) и ограничения. Установлено, что задача бота — помогать пользователю с саморефлексией, отвечая на его сообщения эмпатичным тоном.

- **Изучение технологий.**  

Выбрали JavaScript/Node.js и библиотеку grammY для взаимодействия с Telegram API. Как показало исследование, GPT-4 рекомендовал использовать grammY как простой и эффективный фреймворк для Telegram-ботов. Ознакомились с документацией grammY, а также с использованием ChatGPT API (OpenAI) для обработки естественных запросов.

- **Проектирование архитектуры.**  

Спроектировали структуру бота: модульный код на Node.js с использованием grammY; компонент для работы с OpenAI API (ChatGPT); возможное хранилище (для логов или сессий). Предусмотрели поддержку многошаговой логики (сцены/сессии) и обработки различных языков.

- **Реализация прототипа.**  

Создали новый Telegram-бот через BotFather, получили токен для доступа к Bot API. Настроили окружение: инициализировали npm-проект, установили зависимости (grammY и плагины), настроили переменные окружения (ключ OpenAI, токен бота). Написали код на JavaScript: объект `Bot` из grammY для получения сообщений и функцию вызова ChatGPT API для генерации ответов.

- **Тестирование и отладка.**  

Проверили работу бота: корректность ответов от ChatGPT, обработку ошибок и исключений, логирование. Добавили полезные расширения, например `@grammyjs/conversations` для диалоговых сцен. Задокументировали процесс и подготовили материалы для итогового отчета.

## Техническое руководство

В этом разделе приведены пошаговые инструкции для создания аналогичного Telegram-бота «с нуля» (назначение для начинающих).

- **Регистрация бота в Telegram:**  
  
В Telegram найдите бота BotFather, отправьте команду /newbot и следуйте подсказкам (укажите имя и username бота). В результате BotFather выдаст токен для API, который нужно сохранить. Например, в диалоге с BotFather можно увидеть подобное (обведен токен):

- **Инициализация проекта:**  

На локальной машине установите Node.js. Откройте терминал и выполните:

```npm init -y```

```
npm install grammy @grammyjs/conversations @grammyjs/parse-mode @grammyjs/ratelimiter @grammyjs/runner @grammyjs/transformer-throttler openai dotenv --save
```
  Здесь мы устанавливаем grammY и полезные плагины (напр.
`@grammyjs/conversations`для сценариев диалога ), а также библиотеку openai для работы с ChatGPT.

Создание основного кода бота: в проекте создайте файл `bot.js` (или `index.js` ) и импортируйте необходимые модули.

- **Настройка окружения:** 

Создайте файл `.env` и положите туда секретные ключи, например:
```
BOT_TOKEN=ваш_токен_от_BotFather
OPENAI_API_KEY=ваш_api_ключ_OpenAI
```

Используйте пакет `dotenv` для загрузки этих переменных в приложение. Такой подход  
защищает секреты и упрощает конфигурацию.

- **Дополнительные улучшения:** 

При необходимости можно добавить **поддержку многоязычности** (передавать в ChatGPT инструкцию о языке или использовать API перевода)

**Обработка эмоций** (напр. анализировать текст на эмоциональную окраску)

**Расширенное логирование и регистрацию** (например, `console.log` или библиотеки вроде `winston` для сохранения логов)  

`GrammY` позволяет легко подключать плагин `sessions` для сохранения состояния беседы и `conversations` для развернутых сценариев диалога.



- **Запуск и тестирование:**

Добавьте в `package.json` скрипт для запуска, например:
```"dev": "nodemon --exec node bot.js"``` Запустите ```npm run dev``` и проверьте работу бота в Telegram. Если бот не отвечает, проверьте правильность токена, установку зависимостей и доступ к сети. После успешного теста проект готов к оформлению и загрузке в репозиторий.



# Модификации проекта

На основе полученных знаний в проект были добавлены следующие улучшения:

- **Новые сцены и диалоги**:  

Введен плагин `@grammyjs/conversations`, позволяющий организовывать многошаговые разговоры (сцены) с пользователем. Это полезно для структурированных опросов или пошаговой инструкции.

- **Обработка эмоций**:  
  
  Для оценки эмоционального состояния пользователя используется дополнительный запрос к ChatGPT с анализом текста (напр. “определи эмоциональную окраску этого сообщения”). Это позволяет боту адаптировать ответы (например, быть более сочувственным при обнаружении грусти).

- **Мультиязычность**:  
  
  Бот поддерживает несколько языков. При детектировании языка входящего сообщения бот перенаправляет запрос в соответствующую модель (через ChatGPT) или использует встроенный перевод. Это расширяет аудиторию пользователей.

- **Логирование и мониторинг**:  
  
  В проект добавлен модуль логирования (например, библиотека `winston`) для записи ошибок и важных событий. Журналы позволяют анализировать работу бота и при необходимости быстро реагировать на сбои.

Эти изменения повышают гибкость и надежность бота, а также улучшают пользовательский опыт.


# Итоговый отчёт

### Хронология этапов проекта:

1. **Подготовительный этап (неделя 1)**:  
   Сбор требований и анализ предметной области;  
   Исследование существующих решений (чаты-психологи в Telegram).

2. **Проектирование (неделя 2)**:  
   Выбор технологий (JavaScript, grammY, OpenAI API),  
   Проектирование архитектуры бота и структуры кода;  
   Подготовка схем (см. раздел Визуализации).

3. **Реализация (недели 3–4)**:  
   Кодирование бота (регистрация в BotFather, установка пакетов,  
   написание основного кода с обработчиками граммы и запросами к ChatGPT),  
   Проведение тестирования и отладки.

4. **Доработка и оформление (неделя 5)**:  
   Добавление новых функций (мультиязычность, сцены, логирование),  
   Написание технического руководства и отчета,  
   Подготовка презентации и видео.
   

